<%# Active Storage > fallback %>
<% image_map = {
  "ashwagandha bio" => "Ashwagandha_bio.png",
  "curcuma bio" => "Curcuma_bio.png",
  "farine de coco bio" => "Farinedecoco_bio.png",
  "gingembre bio" => "Gingembre_bio.png",
  "graines de lin bio" => "Grainesdelin_bio.png",
  "maca bio" => "Maca_bio.png",
  "noix du brésil bio" => "NoixduBresil_Bio.png",
  "romarin bio" => "Romarin_Bio.png",
  "spiruline bio" => "Spiruline_Bio.png"
} %>

<% image_file = image_map[@product.name.downcase.strip] %>

<div class="container my-5">
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <% if alert %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= alert %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <h1 class="mb-4 display-5 text-primary fw-bold"><%= @product.name.capitalize %></h1>

  <div class="row g-4">
    <div class="col-md-6">
      <% if @product.image.attached? %>
        <%= image_tag url_for(@product.image), class: "img-fluid rounded shadow", alt: @product.name %>
      <% elsif image_file.present? %>
        <%= image_tag "products/#{image_file}", class: "img-fluid", style: "max-width: 300px; height: auto;" %>
      <% else %>
        <p class="text-muted">Aucune image disponible</p>
      <% end %>
    </div>

    <div class="col-md-6">
      <p class="lead"><%= @product.description %></p>
      <p class="h4 text-success fw-semibold"><%= number_to_currency(@product.price, unit: "€") %></p>

      <% if @product.long_description.present? %>
        <hr class="my-4">
        <h2 class="h5 text-secondary fw-bold">En savoir plus</h2>
        <p class="text-muted" style="white-space: pre-line;"><%= simple_format(@product.long_description) %></p>
      <% end %>

      <div class="form-group my-3">
        <%= form_with url: add_to_cart_cart_path(product_id: @product.id, quantity: 1), method: :get, local: true, id: "add-to-cart-form" do |form| %>
          <%= label_tag :quantity, "Quantité", class: "form-label" %>
          <%= number_field_tag :quantity, 1, min: 1, class: "form-control w-50", id: "quantity-input" %>

          <div class="my-3">
            <%= form.submit "Ajouter au panier", class: "btn btn-success" %>
          </div>
        <% end %>
      </div>

      <div class="d-flex flex-wrap gap-2 my-3">
        <%= link_to "Voir le panier", cart_path, class: "btn btn-outline-secondary" %>
        <%= link_to "Retour à la boutique", products_path, class: "btn btn-outline-primary" %>
      </div>

      <% if user_signed_in? && current_user.admin? %>
        <hr>
        <div class="d-flex flex-wrap gap-2 mt-3">
          <%= link_to "Modifier", edit_product_path(@product), class: "btn btn-warning" %>
          <%= button_to "Supprimer", product_path(@product), method: :delete, data: { confirm: "Confirmer la suppression ?" }, class: "btn btn-danger" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
